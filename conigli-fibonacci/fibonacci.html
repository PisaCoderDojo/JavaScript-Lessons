<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-image: url('grass.jpg');
}
</style>
</head>

<script>

var conigli = [];
var mese;
var width = 480;
var height = 270;
var base_image = new Image();
var frameMese = 150;
base_image.src = 'rabbit.png';
    
function startGame() {
    while (conigli.length < 2) {
        var coniglio = new Coniglio();
        conigli.push(coniglio);
    }
    areaGioco.start();
}

var areaGioco = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = width;
        this.canvas.height = height;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        mese = 0;
        this.interval = setInterval(updateGameArea, 20);
        },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}

function updateGameArea() {
    var x, height, gap, minHeight, maxHeight, minGap, maxGap;
    rimuoviCliccati();
    areaGioco.clear();
    areaGioco.frameNo += 1;
    var nuovi = []
    if (areaGioco.frameNo == 1 || ogniMese(frameMese)) {
        mese +=1;
        var coppia = 0;
        for (i = 0; i < conigli.length; i++) {
          conigli[i].aggiungiMese();
          if (conigli[i].fertile) {
              coppia += 1;
          }
          if (coppia == 2){
            var coniglio = new Coniglio();
            nuovi.push(coniglio);
            coppia = 0;
          }
        }
        conigli=conigli.concat(nuovi) 
    }
    for (i = 0; i < conigli.length; i++) {
        conigli[i].draw();
        conigli[i].update();
    }
    scriviTesto();
}

function rimuoviCliccati(){
    for(var i = conigli.length - 1; i >= 0; i--) {
        if(conigli[i].cliccato) {
            conigli.splice(i, 1);
        }
    }
}
    
function ogniMese(n) {
    if ((areaGioco.frameNo / n) % 1 == 0) {return true;}
    return false;
}

function scriviTesto() {
    areaGioco.context.font = "18px Arial";
    areaGioco.context.fillStyle = "white";
    areaGioco.context.fillText("MESE: "+mese+" - Coppie Fertili: " + coppieFertili(), 8, 20);
}
    
function coppieFertili(){
    var fibo = 0;
    for (i = 0; i < conigli.length; i++) {
        if (conigli[i].fertile) {
            fibo += 1;
        }
    } 
    return Math.floor(fibo / 2);
}
    
function Coniglio() {
  this.x = random(80, width-80);
  this.y = random(80, height-80);
  this.velX = random(-4, 4);
  this.velY = random(-4, 4);
  this.size = 10
  this.age = 0;  
  this.fertile = false;
  this.cliccato = false;
}
Coniglio.prototype.draw = function() {
  areaGioco.context.drawImage(base_image, this.x-this.size, this.y-this.size,this.size*2, this.size*2);
}

Coniglio.prototype.update = function() {
  if (this.age < 2){
      this.size += 0.06
  }   
  if ((this.x + this.size) >= width) {
    this.velX = -(this.velX);
  }
  if ((this.x - this.size) <= 0) {
    this.velX = -(this.velX);
  }
  if ((this.y + this.size) >= height) {
    this.velY = -(this.velY);
  }
  if ((this.y - this.size) <= 0) {
    this.velY = -(this.velY);
  }
  this.x += this.velX;
  this.y += this.velY;
}

Coniglio.prototype.aggiungiMese = function() {
    this.age += 1;
    if (this.age == 2){
        this.fertile = true;
    }
} 

function random(min,max) {
  var num = Math.floor(Math.random()*(max-min)) + min;
  return num;
}

 function intersecato(punto, cerchio) {
  return Math.sqrt((punto.x-cerchio.x) ** 2 + (punto.y - cerchio.y) ** 2) < cerchio.size;
}

areaGioco.canvas.addEventListener('click', (e) => {
  const posizioneMouse = {
    x: e.clientX,
    y: e.clientY
  };
  conigli.forEach(coniglio => {
    if (intersecato(posizioneMouse, coniglio)) {
      coniglio.cliccato = true;
    }
  });
});   

</script>
<body onload="startGame()">
<br>

<h1>Conigli di Fibonacci</h1>
    <p>L'intento di Leonardo Fibonacci era quello di trovare una legge matematica che descrivesse la crescita di una popolazione di conigli.</p>

    <p>Assumendo per ipotesi che:</p>
<ul>
    <li> si disponga di una coppia di conigli appena nati
    </li>

<li>questa coppia (la prima) diventi fertile al compimento del primo mese e dia alla luce una nuova coppia al compimento del secondo mese;</li>
<li>le nuove coppie nate si comportino in modo analogo;</li>
<li>le coppie fertili, dal secondo mese di vita in poi, diano alla luce una coppia di figli al mese;</li>
    </ul>
<p>si verifica quanto segue:</p>
<ul>
    <li>dopo un mese una coppia di conigli sarà fertile,
    </li>
    <li>dopo due mesi ci saranno due coppie di cui una sola fertile,
    </li>
    <li>nel mese seguente (terzo mese dal momento iniziale) ci saranno 2+1=3 coppie perché solo la coppia fertile avrà generato; di queste tre due saranno le coppie fertili, quindi</li>
     <li>nel mese seguente (quarto mese dal momento iniziale) ci saranno 3+2=5 coppie</li>
     <li>In questo esempio, il numero di coppie di conigli di ogni mese esprime la successione di Fibonacci.</li>
    </ul>

    <p>Testo da <a href="https://it.wikipedia.org/wiki/Successione_di_Fibonacci">Wikipedia</a></p>
    </body>
</html>
